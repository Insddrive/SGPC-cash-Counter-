<!DOCTYPE html>
<html lang="pa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kzana Counter</title>
    
    <!-- PWA Setup for Android & iOS -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#FF9933">
    
    <!-- iOS Specific Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Kzana Counter">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Gurmukhi:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Noto Sans Gurmukhi', sans-serif;
            background-color: #FFF8E1;
            -webkit-tap-highlight-color: transparent;
            display: flex; flex-direction: column; min-height: 100vh;
            overscroll-behavior-y: none; /* Disables pull-to-refresh on mobile */
        }
        .input-box {
            background: white; border: 1px solid #FFCC80;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.05); transition: all 0.2s;
        }
        .input-box:focus { border-color: #1e3a8a; outline: none; box-shadow: 0 0 0 2px rgba(30, 58, 138, 0.1); }
        .header-bg {
            background: #FF9933;
            background-image: radial-gradient(#d97706 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .footer-credit { font-size: 10px; color: #666; text-align: center; padding: 8px; background: #fff; border-top: 1px solid #eee; margin-top: auto; }
        
        /* Install Prompt Animation */
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .install-prompt { animation: slideUp 0.5s ease-out; }

        @media print {
            body { background: white; -webkit-print-color-adjust: exact; }
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            .print-footer-container { position: fixed; bottom: 0; left: 0; width: 100%; background: white; padding-bottom: 10px; }
            .content-container { margin-bottom: 150px; }
            
            input { 
                border: none !important; background: transparent !important; 
                padding: 0 !important; text-align: center; font-weight: bold; color: black !important;
            }
            .avg-amount-input { text-align: right !important; }
        }
        .print-only { display: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Utils ---
        const formatIndianNumber = (num) => {
            if (!num && num !== 0) return "";
            const cleanNum = num.toString().replace(/,/g, '');
            if (isNaN(cleanNum) || cleanNum === "") return "";
            return parseInt(cleanNum).toLocaleString('en-IN');
        };
        const cleanNumber = (val) => val ? val.toString().replace(/,/g, '') : "";
        
        const toGurmukhiNumerals = (input) => {
            if (!input) return "";
            const map = {'0':'੦','1':'੧','2':'੨','3':'੩','4':'੪','5':'੫','6':'੬','7':'੭','8':'੮','9':'੯'};
            return input.toString().split('').map(char => map[char] || char).join('');
        };

        const numberToEnglish = (n) => {
            if (n === 0) return "Zero Only";
            const single = ["", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine"];
            const double = ["Ten", "Eleven", "Twelve", "Thirteen", "Fourteen", "Fifteen", "Sixteen", "Seventeen", "Eighteen", "Nineteen"];
            const tens = ["", "", "Twenty", "Thirty", "Forty", "Fifty", "Sixty", "Seventy", "Eighty", "Ninety"];
            const convert = (num) => {
                if (num < 10) return single[num];
                if (num < 20) return double[num - 10];
                if (num < 100) return tens[Math.floor(num / 10)] + (num % 10 !== 0 ? " " + single[num % 10] : "");
                if (num < 1000) return single[Math.floor(num / 100)] + " Hundred" + (num % 100 !== 0 ? " " + convert(num % 100) : "");
                return "";
            };
            let str = ""; let num = Math.floor(n);
            if (num >= 10000000) { str += convert(Math.floor(num / 10000000)) + " Crore "; num %= 10000000; }
            if (num >= 100000) { str += convert(Math.floor(num / 100000)) + " Lakh "; num %= 100000; }
            if (num >= 1000) { str += convert(Math.floor(num / 1000)) + " Thousand "; num %= 1000; }
            if (num > 0) { str += convert(num); }
            return str.trim() + " Only";
        };

        const getDetailedDate = () => {
            const d = new Date();
            const day = d.getDate();
            const month = d.toLocaleDateString('pa-IN', { month: 'long' });
            const monthNum = d.getMonth() + 1;
            const year = d.getFullYear();
            const weekday = d.toLocaleDateString('pa-IN', { weekday: 'long' });
            return `${weekday}, ${day} ${month} (${monthNum}) ${year}`;
        };

        // --- Install Prompt Component ---
        const InstallPrompt = () => {
            const [deferredPrompt, setDeferredPrompt] = useState(null);
            const [show, setShow] = useState(false);
            const [isIOS, setIsIOS] = useState(false);

            useEffect(() => {
                // Check if iOS
                const ios = /iPhone|iPad|iPod/.test(navigator.userAgent) && !window.MSStream;
                const isInStandalone = window.navigator.standalone || (window.matchMedia('(display-mode: standalone)').matches);
                
                if (ios && !isInStandalone) {
                    setIsIOS(true);
                    // Show iOS instruction after 2 seconds
                    setTimeout(() => setShow(true), 2000);
                }

                // Android / Desktop handling
                const handler = (e) => {
                    e.preventDefault();
                    setDeferredPrompt(e);
                    setShow(true);
                };
                window.addEventListener('beforeinstallprompt', handler);
                return () => window.removeEventListener('beforeinstallprompt', handler);
            }, []);

            const handleInstall = async () => {
                if (!deferredPrompt) return;
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    setShow(false);
                }
                setDeferredPrompt(null);
            };

            if (!show) return null;

            return (
                <div className="fixed bottom-4 left-4 right-4 bg-white rounded-xl shadow-2xl p-4 z-50 border border-gray-200 install-prompt flex items-center justify-between no-print">
                    <div className="flex items-center gap-3">
                        <div className="bg-[#FF9933] p-2 rounded-lg text-white">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                        </div>
                        <div>
                            <p className="font-bold text-sm text-gray-800">Kzana Counter</p>
                            <p className="text-xs text-gray-500">
                                {isIOS ? "ਇੰਸਟਾਲ ਕਰਨ ਲਈ 'Share' ਦੱਬੋ ਅਤੇ 'Add to Home Screen' ਚੁਣੋ" : "ਐਪ ਇੰਸਟਾਲ ਕਰੋ"}
                            </p>
                        </div>
                    </div>
                    <div className="flex gap-2">
                        {!isIOS && (
                            <button onClick={handleInstall} className="bg-[#1e3a8a] text-white text-xs font-bold px-3 py-2 rounded-lg shadow">
                                Install
                            </button>
                        )}
                        <button onClick={() => setShow(false)} className="text-gray-400 p-1 hover:text-gray-600">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                        </button>
                    </div>
                </div>
            );
        };

        // --- Calculator ---
        const CalculatorModal = ({ isOpen, onClose, onSave }) => {
            const [input, setInput] = useState("");
            useEffect(() => { if(isOpen) setInput(""); }, [isOpen]);
            if (!isOpen) return null;
            const handleBtn = (val) => setInput(prev => prev + val);
            const calculate = () => {
                try {
                    const res = Function('"use strict";return (' + input.replace(/[^-()\d/*+.]/g, '') + ')')();
                    onSave(Math.floor(res)); onClose();
                } catch (e) { alert("ਗਲਤ ਹਿਸਾਬ"); }
            };
            return (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-end sm:items-center justify-center z-50 p-0 sm:p-4 no-print">
                    <div className="bg-white rounded-t-2xl sm:rounded-2xl w-full max-w-sm overflow-hidden shadow-2xl">
                        <div className="bg-[#1e3a8a] p-3 flex justify-between items-center text-white">
                            <h3 className="font-bold">ਕੈਲਕੁਲੇਟਰ</h3><button onClick={onClose} className="text-2xl">&times;</button>
                        </div>
                        <div className="bg-gray-50 border-b p-3 text-right text-3xl font-mono font-bold">{input || "0"}</div>
                        <div className="grid grid-cols-4 gap-2 p-3 bg-gray-100">
                            {['7','8','9','/','4','5','6','*','1','2','3','-'].map(b => <button key={b} onClick={() => handleBtn(b)} className="p-4 bg-white rounded shadow font-bold text-xl text-blue-900">{b.replace('*','×')}</button>)}
                            <button onClick={() => setInput("")} className="p-4 bg-red-100 text-red-700 rounded font-bold">C</button>
                            <button onClick={() => handleBtn('0')} className="p-4 bg-white rounded shadow font-bold text-xl">0</button>
                            <button onClick={() => setInput(prev => prev.slice(0, -1))} className="p-4 bg-orange-100 text-orange-700 rounded font-bold">⌫</button>
                            <button onClick={() => handleBtn('+')} className="p-4 bg-white rounded shadow font-bold text-xl">+</button>
                            <button onClick={calculate} className="col-span-4 p-3 bg-[#FF9933] text-white rounded shadow font-bold mt-1">ਨਤੀਜਾ ਜੋੜੋ (SAVE)</button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- App ---
        const App = () => {
            const [activeTab, setActiveTab] = useState("counter");
            const denoms = [500, 200, 100, 50, 20, 10, 5, 2, 1];

            // State
            const [notes, setNotes] = useState({});
            const [extraAmount, setExtraAmount] = useState("");
            const [gurmukhiNumInput, setGurmukhiNumInput] = useState("");
            const [bundles, setBundles] = useState({});
            const [avgValues, setAvgValues] = useState({});
            const [avgDirectAmount, setAvgDirectAmount] = useState("");
            const [avgMethod, setAvgMethod] = useState("detailed");
            const [startDate, setStartDate] = useState("");
            const [endDate, setEndDate] = useState("");
            
            const [showCalc, setShowCalc] = useState(false);
            const [punjabiDate, setPunjabiDate] = useState("");

            useEffect(() => {
                setPunjabiDate(getDetailedDate());
                const saved = localStorage.getItem('sgpcCashV6_Final');
                if (saved) {
                    const d = JSON.parse(saved);
                    setNotes(d.notes || {}); setExtraAmount(d.extraAmount || ""); setGurmukhiNumInput(d.gurmukhiNumInput || "");
                    setBundles(d.bundles || {}); 
                    setAvgValues(d.avgValues || {}); setAvgDirectAmount(d.avgDirectAmount || ""); setAvgMethod(d.avgMethod || "detailed");
                    setStartDate(d.startDate || ""); setEndDate(d.endDate || "");
                }
            }, []);

            useEffect(() => {
                localStorage.setItem('sgpcCashV6_Final', JSON.stringify({ 
                    notes, extraAmount, gurmukhiNumInput, bundles, avgValues, avgDirectAmount, avgMethod, startDate, endDate 
                }));
            }, [notes, extraAmount, gurmukhiNumInput, bundles, avgValues, avgDirectAmount, avgMethod, startDate, endDate]);

            // Calculations
            const counterTotal = () => {
                let sum = 0; denoms.forEach(d => sum += (parseInt(cleanNumber(notes[d])) || 0) * d);
                return sum + (parseInt(cleanNumber(extraAmount)) || 0);
            };

            const bundleTotal = () => {
                let sum = 0;
                denoms.forEach(d => {
                    const bigVal = parseInt(cleanNumber(bundles[d]?.bigVal)) || 0;
                    const bigCount = parseInt(cleanNumber(bundles[d]?.bigCount)) || 0;
                    sum += (bigVal * bigCount);
                });
                return sum;
            };

            const getAvgResults = () => {
                if (!startDate || !endDate) return null;
                const days = Math.ceil((new Date(endDate) - new Date(startDate)) / (86400000)) + 1;
                if (days <= 0) return null;
                let sum = 0;
                if (avgMethod === 'direct') {
                    sum = parseInt(cleanNumber(avgDirectAmount)) || 0;
                } else {
                    denoms.forEach(d => sum += (parseInt(cleanNumber(avgValues[d])) || 0));
                }
                return { days, grandTotal: sum, dailyGrandAvg: sum / days };
            };
            const avgResult = getAvgResults();

            const handleReset = () => {
                if (activeTab === 'counter') {
                    if(confirm("ਕੀ ਤੁਸੀਂ 'ਕੈਸ਼ ਕਾਊਂਟਰ' ਸਾਫ਼ ਕਰਨਾ ਚਾਹੁੰਦੇ ਹੋ?")) { setNotes({}); setExtraAmount(""); setGurmukhiNumInput(""); }
                } else if (activeTab === 'bundles') {
                    if(confirm("ਕੀ ਤੁਸੀਂ 'ਬੰਡਲ ਗਿਣਤੀ' ਸਾਫ਼ ਕਰਨਾ ਚਾਹੁੰਦੇ ਹੋ?")) setBundles({});
                } else if (activeTab === 'average') {
                    if(confirm("ਕੀ ਤੁਸੀਂ 'ਔਸਤ' ਡਾਟਾ ਸਾਫ਼ ਕਰਨਾ ਚਾਹੁੰਦੇ ਹੋ?")) { setAvgValues({}); setAvgDirectAmount(""); setStartDate(""); setEndDate(""); }
                }
            };

            const printPDF = () => window.print();

            const downloadExcel = () => {
                let csvContent = "\uFEFF"; 
                let filename = "Data.csv";

                if (activeTab === 'counter') {
                    filename = "Kzana_Counter.csv";
                    csvContent += "ਨੋਟ (Note),ਗਿਣਤੀ (Count),ਕੁੱਲ (Total)\n";
                    denoms.forEach(d => {
                        const count = parseInt(cleanNumber(notes[d])) || 0;
                        csvContent += `${d},${count},${count * d}\n`;
                    });
                    const extra = parseInt(cleanNumber(extraAmount)) || 0;
                    csvContent += `ਹੋਰ ਰਕਮ (Extra),-,${extra}\n`;
                    csvContent += `,,${counterTotal()}\n`;
                    
                } else if (activeTab === 'bundles') {
                    filename = "Kzana_Bundles.csv";
                    csvContent += "ਨੋਟ (Note),ਛੋਟਾ ਬੰਡਲ ਮੁੱਲ,ਵੱਡਾ ਬੰਡਲ ਮੁੱਲ,ਵੱਡਾ ਬੰਡਲ ਗਿਣਤੀ,ਕੁੱਲ\n";
                    denoms.forEach(d => {
                        const sv = parseInt(cleanNumber(bundles[d]?.smallVal)) || 0;
                        const bv = parseInt(cleanNumber(bundles[d]?.bigVal)) || 0;
                        const bc = parseInt(cleanNumber(bundles[d]?.bigCount)) || 0;
                        const total = (bv * bc);
                        csvContent += `${d},${sv},${bv},${bc},${total}\n`;
                    });
                    csvContent += `,,,,,${bundleTotal()}\n`;

                } else if (activeTab === 'average') {
                    filename = "Kzana_Average.csv";
                    csvContent += `ਤਰੀਕ ਤੋਂ: ${startDate}, ਤਰੀਕ ਤੱਕ: ${endDate}\n`;
                    if(avgResult) {
                        csvContent += `ਕੁੱਲ ਦਿਨ: ${avgResult.days}\n\n`;
                        if (avgMethod === 'direct') {
                             csvContent += `ਸਿੱਧੀ ਰਕਮ,${avgDirectAmount}\n`;
                        } else {
                            csvContent += "ਨੋਟ (Note),ਕੁੱਲ ਰਕਮ (Total Value),ਰੋਜ਼ਾਨਾ ਔਸਤ (Daily Avg)\n";
                            denoms.forEach(d => {
                                const val = parseInt(cleanNumber(avgValues[d])) || 0;
                                const avg = val / avgResult.days;
                                csvContent += `${d},${val},${avg.toFixed(2)}\n`;
                            });
                        }
                        csvContent += `,,${avgResult.grandTotal}\n`;
                        csvContent += `ਰੋਜ਼ਾਨਾ ਔਸਤ (Grand Daily Avg),,${avgResult.dailyGrandAvg.toFixed(2)}\n`;
                    } else {
                        csvContent += "ਹਿਸਾਬ ਲਈ ਤਰੀਕਾਂ ਭਰੋ\n";
                    }
                }

                const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
                const link = document.createElement("a");
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const TabBtn = ({ id, label, colorClass }) => (
                <button 
                    onClick={() => setActiveTab(id)} 
                    className={`flex-1 py-3 px-1 rounded-xl text-xs sm:text-sm font-bold transition-all duration-200 shadow-sm border border-black/10 ${activeTab === id ? `${colorClass} text-white shadow-lg scale-105 border-white` : 'bg-white/90 text-gray-500 hover:bg-white'}`}
                >
                    {label}
                </button>
            );

            const FooterCredit = () => (
                <div className="footer-credit mt-auto">ਸੋਫਟਵੇਅਰ ਬਣਾਇਆ ਗਿਆ ਵੱਲੋਂ ਸ: ਇੰਦਰਜੀਤ ਸਿੰਘ ਤਲਵੰਡੀ ਸਾਬੋ | ਫੋਨ ਨੰਬਰ 94644-91806</div>
            );

            return (
                <>
                    <div className="header-bg shadow-lg z-20 sticky top-0 no-print pb-2">
                        <div className="p-2 flex justify-between items-start">
                            <div className="text-white pt-1 pl-2">
                                <h2 className="text-lg font-bold leading-tight drop-shadow-md">ਸ਼੍ਰੋਮਣੀ ਗੁਰਦੁਆਰਾ ਪ੍ਰਬੰਧਕ ਕਮੇਟੀ (ਖ਼ਜ਼ਾਨਾ)</h2>
                                <div className="text-white/90 text-xs mt-1 font-medium">{punjabiDate}</div>
                            </div>
                            <button onClick={handleReset} className="bg-red-600 text-white p-2 rounded-lg shadow border border-white/20 active:scale-95">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
                            </button>
                        </div>
                        <div className="px-3 mt-1">
                            <div className="flex gap-2 p-1.5 rounded-2xl bg-white/10">
                                <TabBtn id="counter" label="ਕੈਸ਼ ਕਾਊਂਟਰ" colorClass="bg-blue-600" />
                                <TabBtn id="bundles" label="ਬੰਡਲ ਗਿਣਤੀ" colorClass="bg-yellow-500" />
                                <TabBtn id="average" label="ਔਸਤ (Average)" colorClass="bg-[#8B4513]" />
                            </div>
                        </div>
                    </div>

                    <div className="print-only text-center p-4 border-b-2 border-black mb-4">
                        <h1 className="text-2xl font-bold">ਸ਼੍ਰੋਮਣੀ ਗੁਰਦੁਆਰਾ ਪ੍ਰਬੰਧਕ ਕਮੇਟੀ</h1>
                        <h2 className="text-xl">ਸ੍ਰੀ ਦਰਬਾਰ ਸਾਹਿਬ, ਸ੍ਰੀ ਅੰਮ੍ਰਿਤਸਰ</h2>
                        <h3 className="text-lg font-bold mt-2 underline uppercase">
                            {activeTab === 'counter' ? 'ਰੋਜ਼ਾਨਾ ਖ਼ਜ਼ਾਨਾ' : activeTab === 'bundles' ? 'ਬੰਡਲ ਗਿਣਤੀ' : 'ਔਸਤ ਰਿਪੋਰਟ'}
                        </h3>
                        <p>ਤਰੀਕ: {punjabiDate}</p>
                    </div>

                    <div className="flex-1 p-3 max-w-4xl mx-auto w-full content-container">
                        
                        {activeTab === 'counter' && (
                            <div className="space-y-3 animate-in fade-in">
                                <div className="bg-blue-600 text-white rounded-xl p-4 shadow-md flex justify-between items-center print:bg-white print:text-black print:border-2 print:border-black">
                                    <div><p className="text-[10px] font-bold uppercase opacity-80">ਕੁੱਲ ਮਾਇਆ</p><div className="text-3xl font-extrabold mt-1">₹ {formatIndianNumber(counterTotal())}</div></div>
                                    <div className="text-right w-1/2"><p className="text-xs italic">{numberToEnglish(counterTotal())}</p></div>
                                </div>
                                <div className="bg-white rounded-xl shadow-sm border border-blue-100 p-3 flex gap-2 items-center print:border-black">
                                    <div className="flex-1">
                                        <label className="text-blue-800 font-bold text-xs block mb-1 print:text-black">ਹੋਰ ਰਕਮ / ਚਿੱਲਰ</label>
                                        <input type="text" inputMode="numeric" value={formatIndianNumber(extraAmount)} onChange={e => setExtraAmount(cleanNumber(e.target.value))} className="input-box w-full p-2 rounded text-lg font-bold text-blue-900 print:text-black print:pl-0" placeholder="0"/>
                                    </div>
                                    <button onClick={() => setShowCalc(true)} className="bg-blue-600 text-white p-3 rounded-lg shadow no-print mt-4"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="8" y1="6" x2="16" y2="6"/><line x1="16" y1="14" x2="16" y2="14"/><line x1="12" y1="14" x2="12" y2="14"/><line x1="8" y1="14" x2="8" y2="14"/><line x1="16" y1="18" x2="16" y2="18"/><line x1="12" y1="18" x2="12" y2="18"/><line x1="8" y1="18" x2="8" y2="18"/></svg></button>
                                </div>
                                <div className="bg-white rounded-xl shadow-sm border border-blue-100 overflow-hidden print:border-black">
                                    <div className="grid grid-cols-12 gap-2 text-[10px] font-bold text-gray-400 p-2 border-b bg-gray-50 print:text-black">
                                        <div className="col-span-3 text-right">ਨੋਟ</div><div className="col-span-4 text-center">ਗਿਣਤੀ</div><div className="col-span-5 text-right">ਕੁੱਲ</div>
                                    </div>
                                    {denoms.map(d => (
                                        <div key={d} className="grid grid-cols-12 gap-2 items-center border-b border-gray-50 p-2 print:border-gray-200">
                                            <div className="col-span-3 text-right font-bold text-gray-700 text-lg print:text-black">₹{d}</div>
                                            <div className="col-span-4"><input type="number" value={notes[d] || ""} onChange={e => setNotes({...notes, [d]: e.target.value})} placeholder="0" className="input-box w-full p-1.5 rounded text-center text-lg font-bold text-blue-900 print:text-black"/></div>
                                            <div className="col-span-5 text-right font-medium text-gray-600 print:text-black">{formatIndianNumber((parseInt(notes[d])||0)*d)}</div>
                                        </div>
                                    ))}
                                </div>
                                <div className="bg-orange-50 rounded-xl border border-orange-200 p-3 no-print flex gap-2 items-center">
                                    <input type="number" value={gurmukhiNumInput} onChange={e => setGurmukhiNumInput(e.target.value)} placeholder="123" className="w-1/3 input-box p-2 rounded text-center"/>
                                    <span className="text-orange-400">➔</span>
                                    <div className="flex-1 font-bold text-xl text-blue-900">{gurmukhiNumInput ? toGurmukhiNumerals(gurmukhiNumInput) : "-"}</div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'bundles' && (
                            <div className="space-y-3 animate-in fade-in">
                                <div className="bg-yellow-500 text-black rounded-xl p-4 shadow-md flex justify-between items-center print:bg-white print:text-black print:border-2 print:border-black">
                                    <div><p className="text-[10px] font-bold uppercase opacity-70">ਬੰਡਲਾਂ ਦਾ ਕੁੱਲ ਜੋੜ</p><div className="text-3xl font-extrabold mt-1">₹ {formatIndianNumber(bundleTotal())}</div></div>
                                    <div className="text-right w-1/2"><p className="text-xs italic">{numberToEnglish(bundleTotal())}</p></div>
                                </div>
                                <div className="bg-white rounded-xl shadow-sm border border-yellow-200 overflow-hidden print:border-black">
                                    <div className="p-2 overflow-x-auto">
                                        <table className="w-full text-sm min-w-[350px]">
                                            <thead className="bg-yellow-50 text-yellow-900 border-b print:bg-gray-100">
                                                <tr>
                                                    <th className="p-2 text-left w-12">ਨੋਟ</th>
                                                    <th className="p-2 text-center border-l border-yellow-200 w-1/4">ਛੋਟਾ ਬੰਡਲ<br/><span className="text-[9px] font-normal">(ਸਿਰਫ ਰਕਮ)</span></th>
                                                    <th className="p-2 text-center border-l border-yellow-200 w-1/4">ਵੱਡਾ ਬੰਡਲ<br/><span className="text-[9px] font-normal">(ਰਕਮ)</span></th>
                                                    <th className="p-2 text-center border-l border-yellow-200 w-16">ਗਿਣਤੀ<br/><span className="text-[9px] font-normal">(ਵੱਡੇ)</span></th>
                                                    <th className="p-2 text-right">ਕੁੱਲ</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                            {denoms.map(d => {
                                                const bv = parseInt(cleanNumber(bundles[d]?.bigVal))||0;
                                                const bc = parseInt(cleanNumber(bundles[d]?.bigCount))||0;
                                                const total = (bv*bc);
                                                return (
                                                    <tr key={d} className="border-b last:border-0">
                                                        <td className="p-2 font-bold text-gray-700">₹{d}</td>
                                                        <td className="p-1 border-l border-yellow-100"><input type="text" placeholder="ਮੁੱਲ" value={formatIndianNumber(bundles[d]?.smallVal)} onChange={e => setBundles({...bundles, [d]:{...bundles[d], smallVal: cleanNumber(e.target.value)}})} className="w-full p-1.5 input-box text-center text-xs font-bold rounded placeholder-gray-300"/></td>
                                                        <td className="p-1 border-l border-yellow-100"><input type="text" placeholder="ਮੁੱਲ" value={formatIndianNumber(bundles[d]?.bigVal)} onChange={e => setBundles({...bundles, [d]:{...bundles[d], bigVal: cleanNumber(e.target.value)}})} className="w-full p-1.5 input-box text-center text-xs font-bold rounded placeholder-gray-300"/></td>
                                                        <td className="p-1 border-l border-yellow-100"><input type="number" placeholder="0" value={bundles[d]?.bigCount||""} onChange={e => setBundles({...bundles, [d]:{...bundles[d], bigCount: e.target.value}})} className="w-full p-1.5 input-box text-center text-xs font-bold rounded bg-yellow-50 placeholder-gray-300"/></td>
                                                        <td className="p-2 text-right font-bold text-gray-600 text-xs">{formatIndianNumber(total)}</td>
                                                    </tr>
                                                )
                                            })}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'average' && (
                            <div className="space-y-3 animate-in fade-in">
                                <div className="bg-white p-3 rounded-xl shadow-sm border border-black/10 print:border-black">
                                    <div className="grid grid-cols-2 gap-3">
                                        <div><label className="text-[10px] font-bold uppercase text-gray-500">ਮਿਤੀ ਤੋਂ</label><input type="date" value={startDate} onChange={e => setStartDate(e.target.value)} className="w-full mt-1 p-1 bg-gray-50 rounded border"/></div>
                                        <div><label className="text-[10px] font-bold uppercase text-gray-500">ਮਿਤੀ ਤੱਕ</label><input type="date" value={endDate} onChange={e => setEndDate(e.target.value)} className="w-full mt-1 p-1 bg-gray-50 rounded border"/></div>
                                    </div>
                                </div>

                                <div className="flex gap-2 bg-gray-100 p-1 rounded-lg no-print">
                                    <button onClick={() => setAvgMethod('detailed')} className={`flex-1 py-1 text-xs font-bold rounded ${avgMethod === 'detailed' ? 'bg-white shadow text-[#8B4513]' : 'text-gray-400'}`}>ਨੋਟਾਂ ਦਾ ਵੇਰਵਾ</button>
                                    <button onClick={() => setAvgMethod('direct')} className={`flex-1 py-1 text-xs font-bold rounded ${avgMethod === 'direct' ? 'bg-white shadow text-[#8B4513]' : 'text-gray-400'}`}>ਸਿੱਧੀ ਰਕਮ</button>
                                </div>

                                {avgMethod === 'detailed' ? (
                                    <div className="bg-white rounded-xl shadow-sm border border-stone-200 overflow-hidden print:border-black">
                                        <table className="w-full text-sm">
                                            <thead className="bg-stone-50 text-stone-900 border-b print:bg-gray-100">
                                                <tr>
                                                    <th className="p-2 text-right w-16">ਨੋਟ</th>
                                                    <th className="p-2 text-center w-1/2">ਕੁੱਲ ਰਕਮ ਭਰੋ<br/><span className="text-[9px] font-normal text-red-500 print:hidden">(ਨੋਟਾਂ ਦੀ ਗਿਣਤੀ ਨਹੀਂ)</span></th>
                                                    <th className="p-2 text-right bg-stone-100 print:bg-transparent">ਰੋਜ਼ਾਨਾ ਔਸਤ</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {denoms.map(d => {
                                                    const val = parseInt(cleanNumber(avgValues[d]))||0;
                                                    const avg = avgResult ? val/avgResult.days : 0;
                                                    return (
                                                        <tr key={d} className="border-b last:border-0 print:border-gray-200">
                                                            <td className="p-2 text-right font-bold">₹{d}</td>
                                                            <td className="p-1">
                                                                <input 
                                                                    type="text" 
                                                                    inputMode="numeric" 
                                                                    value={formatIndianNumber(avgValues[d])} 
                                                                    onChange={e => setAvgValues({...avgValues, [d]: cleanNumber(e.target.value)})} 
                                                                    placeholder="0" 
                                                                    className="w-full p-1.5 input-box text-center font-bold avg-amount-input print:text-right print:pr-4"
                                                                />
                                                            </td>
                                                            <td className="p-2 text-right font-bold text-stone-900 bg-stone-50 print:bg-transparent">{formatIndianNumber(avg.toFixed(2))}</td>
                                                        </tr>
                                                    )
                                                })}
                                            </tbody>
                                        </table>
                                    </div>
                                ) : (
                                    <div className="bg-white rounded-xl shadow-sm border border-stone-200 p-4 print:border-black">
                                        <label className="text-sm font-bold text-[#8B4513]">ਸਾਰੇ ਦਿਨਾਂ ਦੀ ਕੁੱਲ ਰਕਮ ਭਰੋ</label>
                                        <input type="text" inputMode="numeric" value={formatIndianNumber(avgDirectAmount)} onChange={e => setAvgDirectAmount(cleanNumber(e.target.value))} className="w-full p-3 input-box text-xl font-bold mt-2 rounded" placeholder="₹ 0"/>
                                    </div>
                                )}

                                {avgResult && avgResult.days > 0 ? (
                                    <div className="bg-stone-100 border border-stone-300 p-4 rounded-xl text-center print:border-black print:bg-transparent">
                                        <div className="grid grid-cols-2 gap-4 text-sm mb-2 border-b border-stone-200 pb-2">
                                            <div>ਕੁੱਲ ਦਿਨ: <b>{avgResult.days}</b></div>
                                            <div>ਕੁੱਲ ਜਮ੍ਹਾਂ ਰਕਮ: <b>₹ {formatIndianNumber(avgResult.grandTotal)}</b></div>
                                        </div>
                                        <p className="text-[#8B4513] text-sm font-bold uppercase">ਰੋਜ਼ਾਨਾ ਕੁੱਲ ਔਸਤ</p>
                                        <p className="text-3xl font-extrabold text-[#8B4513] mt-1">₹ {formatIndianNumber(avgResult.dailyGrandAvg.toFixed(2))}</p>
                                    </div>
                                ) : (
                                    <div className="text-center text-gray-400 text-xs py-2">ਤਰੀਕਾਂ ਭਰੋ ਅਤੇ ਰਕਮ ਲਿਖੋ...</div>
                                )}
                            </div>
                        )}

                        <div className="flex gap-2 mt-4 no-print">
                            <button onClick={printPDF} className="flex-1 bg-[#333] text-white font-bold py-4 rounded-xl shadow-lg flex justify-center items-center gap-2 active:scale-95 transition-transform">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M6 9V2h12v7"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><path d="M6 14h12v8H6z"/></svg>
                                PDF
                            </button>
                            <button onClick={downloadExcel} className="flex-1 bg-green-600 text-white font-bold py-4 rounded-xl shadow-lg flex justify-center items-center gap-2 active:scale-95 transition-transform">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
                                Excel
                            </button>
                        </div>
                        
                        <div className="h-4 no-print"></div>
                        <div className="no-print"><FooterCredit /></div>
                    </div>
                    
                    <InstallPrompt />
                    <CalculatorModal isOpen={showCalc} onClose={() => setShowCalc(false)} onSave={(val) => setExtraAmount(val.toString())} />
                    
                    <div className="print-footer-container print-only">
                        <div className="flex justify-between px-10 mb-4 pt-4">
                            <div className="text-center"><div className="h-10"></div><div className="border-t-2 border-black w-48 mx-auto"></div><p className="font-bold mt-1">ਸੁਪਰਵਾਈਜ਼ਰ/ਇੰਚਾਰਜ</p></div>
                            <div className="text-center"><div className="h-10"></div><div className="border-t-2 border-black w-48 mx-auto"></div><p className="font-bold mt-1">ਮੈਨੇਜਰ</p></div>
                        </div>
                        <FooterCredit />
                    </div>
                </>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
        
        if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js').then(() => console.log('SW Registered')); }
    </script>
</body>
</html>


